{% extends "base.html" %}
{% load static %}
{% block title %}Account Settings{% endblock %}
{% block style %}
{% endblock %}
{% block content %}

{% csrf_token %}
<div class="mb-3">
    <h3 class="mb-5">Account Settings<h3>
        <h4>Account Details</h4>
        {% comment %} <div class="mb-1">
            <label class="form-label">Account Position Type:</label>
            <b><label id="user_type">{{user.acc_type.acc_type_name}}</label></b>
        </div>
        <div class="mb-1">
            <label class="form-label">Account Created:</label>
            <label id="user_created">{{user.acc_created_at}}</label>   
        </div>
        <div class="mb-1">
            <label class="form-label">Last Login:</label>
            <label id="user_lastlogin">{{user.last_login}}</label>  
        </div>
        <div class="mb-1">
            <label class="form-label">Account Userame:</label>
            <b><label id="user_name">{{user.username}}</label></b>
            <input value="{{user.username}}" id="username" type="text" class="form-control mb-4" placeholder="Update Account Username">
            <div id="auMsg">
        </div> {% endcomment %}
</div>
<div id="alertMsg" class="">
</div>
<div class="mb-3">
    <div class="row">
        <div class="col">
            <label class="form-label">Username</label>
            <input id="uname" type="text" class="form-control" placeholder="Enter Username">
            <div id="unameMsg">
            </div>
        </div>
        <div class="col">
            <label class="form-label">First Name</label>
            <input id="fname" type="text" class="form-control" placeholder="Enter First Name">
            <div id="fnameMsg">
            </div>
        </div>
        <div class="col">
            <label class="form-label">Middle Name</label>
            <input id="mname" type="text" class="form-control" placeholder="Enter Middle Name (Optional)">
            <div id="mnameMsg">
            </div>
        </div>
        <div class="col">
            <label class="form-label">Last Name</label>
            <input id="lname" type="text" class="form-control" placeholder="Enter Last Name">
            <div id="lnameMsg">
            </div>
        </div>
    </div>
</div>
<div class="mb-5">
    <div class="row">
        <div class="col">
            <label class="form-label">Phone Number</label>
            <input id="phone" type="number" class="form-control" placeholder="Enter Phone Number">
            <div id="phoneMsg">
            </div>
        </div>
        <div class="col">
            <label class="form-label">Email Address (Recovery Account)</label>
            <input id="email" type="text" class="form-control" placeholder="Enter Email Address">
            <div id="emailMsg">
            </div>
        </div>
        <div class="col">
            <label class="form-label">Birthday</label>
            <input id="bday" type="date" class="form-control" placeholder="mm/dd/yy">
            <div id="bdayMsg">
            </div>
        </div>
    </div>
</div>
<div class="col-12">
    {% if user.acc_type_id != 3 %}
    <button id="btnSubmit" class="btn btn-dark float-end">Submit</button>
    {% endif %}
</div>

{% endblock %}

{% block script %}
    {% if user.acc_type_id != 3 %}
    <script>
        $('#btnSubmit').click(function () {
            id = $('#user_id').text();
            fn = $('#fname').val();
            ln = $('#lname').val();
            u = $('#username').val();
            p = $('#password').val();
            acc_type = $('#user_type').text();

            $.validate_check = function (feed, input, data) {
                txt = !data ? 'Required' : '';
                Ac = !data ? 'is-invalid' : 'is-valid';
                Rc = !data ? 'is-valid' : 'is-invalid';
                Af = !data ? 'invalid-feedback' : 'valid-feedback';
                Rf = !data ? 'valid-feedback' : 'invalid-feedback';
        
                $(feed).text(txt).addClass(Af).removeClass(Rf);
                $(input).addClass(Ac).removeClass(Rc);
            };

            // Check if there's an empty fields
            $.validate_check('#auMsg', '#username', u);
            $.validate_check('#fMsg', '#fname', fn);
            $.validate_check('#lMsg', '#lname', ln);
            $.validate_check('#pwMsg', '#password', p);

            // return if found
            if (!u || !fn || !ln || !p) {           
                return 0;
            }

            $.post("{% url 'Update Account' %}", {
                id: id,
                fname: fn,
                lname: ln,
                username: u,
                password: p,
                acc_type: acc_type
            }, function (e) {
                if (e.code == 200) {
                    $('#alertMsg').text(e.message).addClass('alert alert-success').remove('alert-warning');
                }
                else {
                    $('#alertMsg').text(e.message).addClass('alert alert-warning').remove('alert-success');
                }
            }
            );
        });
        
    </script>
    {% endif %}
{% endblock %}